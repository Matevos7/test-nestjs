## Description

Test

## Installation

```bash
$ npm i --legacy-peer-deps
```

## .env

All of the environment keys are stored in the hidden file.

## Running the app locally

Make sure to have docker installed

```bash
# docker-compose. Up DB and Kafka
$ sudo docker compose -f app.yml up

# development
$ npm run start

# watch mode
$ npm run start:dev

```

### Database

To create the database.
Create the environment keys in the docker.env file.

And run
```bash
$ sudo docker compose -f app.yml up
```
The container will be created. And you can ping to database with the PORT which you provided in the docker env.

## Database migration

1st option.

```
Make synchronize property in the Database connection instance as true.  NOT RECOMMENDED. As per there is a risk to lose a data.
(USE in development mode).
```

2nd option.

```bash
# The migration file will be created in the /src/common/database/migrations/ folder.
$ npm run migration:generate tutorial

# Build the project
$ npm run build

# Migration will be done
$ npm run migration:up

# Migration will be reverted.
$ npm run migration:down

```

## Test

```bash
# unit tests
$ npm run test

# e2e tests
$ npm run test:e2e

# test coverage
$ npm run test:cov
```

## Test environment keys


Please be sure to have your environment keys in the jest/.env.ts file.
Example format of the enviroment key.

jest/.env.ts
```javascript
process.env.ENVIRONMENT=development
```

## API documentation

The API documentation generated by swagger. URL: ``{host}:{port}/api``

## Basics


1. Use .env files (.development.env , .production.env) to set environment variables, which will never be pushed to the repo, because the .env files exists in .gitignore.
2. Here is simple example of .env file.
```javascript
PORT=5000
DATABASE_USER=test_user
DATABASE_PASSWORD=test_password
DATABASE_NAME=test_name
DATABASE_PORT=5496
DATABASE_HOST=test_host
NODE_TLS_REJECT_UNAUTHORIZED=0
```

3. Using class-validator to validate requests.
 Read more here (https://www.npmjs.com/package/class-validator).
4. Branch name example: feature/registration-flow-implementation
5. Commit message example: feat(registration): Implement registration flow

## SRC

The source(src) folder of project includes 3 basic folders.

They are: common, shared and resources.

- common

Under common folder shared the files which could be used in multiple places.

E.g:

```
- Constants

1. All constants kept in constants file are also sorted. Placed into `src/common/constants`.

- Models

1. All the shared models can be used in different functions placed into `src/common/models`.

- Middlewares

1. All of the middlewares placed into `src/common/middlewares`.

- Database

1. Database folder placed into `src/common/database`.
2. Under database folder kept the entitites, migrations and mocks(For test purposes).

- Helpers

1. All of the helper functions can be used in different functions placed into `src/common/helpers`.

```

- shared

```
Shared modules such as kafka and crons goes here.
```

- resources

Using resources folder to create API endpoints.

All of the resources placed into `src/resources/`.

Each of the resources should contain 3 files.

```bash
1. ${resource_name}.controller.ts
2. ${resource_name}.module.ts
3. ${resource_name}.service.ts
```
For creating a resource, use cli running following command

```bash
nest g res ${resource-name} resources
```

Add --no-spec to disable spec files generation.

Depending on resource requirement it may contain other folders, such as dto, helpers, strategies,
 guards and etc, Please note, the files in the folder will not be used in other resources, otherwise
 you should put them in common folder.


## Comments

Here is the example how to make comments in the project.

```typescript
  /**
   * This method aimed to create JWT access token based on provided payload.
   * @param {ITokenPayload} payload
   * @returns {string}
   */

```

## Stay in touch

- Documented By - [Matevos Karapetyan]
